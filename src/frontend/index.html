<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="styles.css">
    </head>
    <body>
        <title>Connect Từ</title>
        <div class="container">
            <div class="top">
                <div class="productName">
                    <label>Connect Từ</label>
                    <!-- Copyright by Squiggly Text https://codepen.io/lbebber/pen/KwGEQv -->
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1">
                        <defs>
                            <filter id="squiggly-0">
                                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="0"/>
                                <feDisplacementMap id="displacement" in="SourceGraphic" in2="noise" scale="6" />
                            </filter>
                            <filter id="squiggly-1">
                                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="1"/>
                        <feDisplacementMap in="SourceGraphic" in2="noise" scale="8" />
                            </filter>
                            
                            <filter id="squiggly-2">
                                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="2"/>
                        <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" />
                            </filter>
                            <filter id="squiggly-3">
                                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="3"/>
                        <feDisplacementMap in="SourceGraphic" in2="noise" scale="8" />
                            </filter>
                            
                            <filter id="squiggly-4">
                                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="4"/>
                        <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" />
                            </filter>
                            </defs> 
                    </svg>
                </div>
                <div class="count">
                    <label id="count">3</label>
                </div>
            </div>
            <div class="answer">
                <label id="outputLabel">Mời bạn đi trước</label>
            </div>
            <div class="center-screen">
                <form onsubmit="return repeatvalue()">
                    <input type="text" id="Response" class="large-input"/>
                </form>
            </div>
            <div class="suggest">
                <label id="compJoke"></label>
            </div>
        </div>
        
        <script>
            function repeatvalue() {
                var txtName = document.getElementById("Response");
                var countLabel = document.getElementById("count");
                var compJoke = document.getElementById("compJoke");
                var outputLabel = document.getElementById("outputLabel");
                var count = parseInt(countLabel.textContent); // Get the current count value as an integer

                var usrWords = txtName.value.split();
                var compWords = outputLabel.value.split();

                if (compWords.length == 2) {
                    if (usrWords[0] != compWords[1]) {
                        count--;
                        countLabel.textContent = count; 
                        comAns.textContent = "Chơi gì kì zậy!";
                        if (count == 0) {
                            window.location.href = 'lose.html';
                            return false;
                        }
                        return false;
                    } 
                }

                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                var raw = JSON.stringify({
                    "input": txtName.value
                });

                var requestOptions = {
                    method: 'POST',
                    headers: myHeaders,
                    body: raw,
                    redirect: 'follow'
                };

                fetch("http://127.0.0.1:5002/process", requestOptions)
                    .then(response => response.json())
                    .then(result => {
                        var output = result["output"];
                        var check = result["check"];
                        var lose = result["lose"];

                        if (!lose) {
                            if (!check) {
                                txtName.classList.add("error"); // Apply the 'error' class to trigger animation
                                txtName.value = '';
                                comAns.textContent = "Từ này dùng rồi mà!";
                                setTimeout(function() {
                                    txtName.classList.remove("error");
                                }, 500);

                                count--;
                                countLabel.textContent = count; 

                                if (count == 0) {
                                    window.location.href = 'lose.html';
                                    return false;
                                }
                                return false;
                            } else {
                                outputLabel.textContent = output;
                                compJoke.textContent = "";
                                return false;
                            }
                        } else {
                            window.location.href = 'lose.html';
                            return false;
                        }

                    })
                    .catch(error => console.log('error', error));

                txtName.value = '';

                return false;
            }
        </script>
    </body>
</html>
